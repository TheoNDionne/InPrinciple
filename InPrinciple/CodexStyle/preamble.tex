%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%                                                      PREAMBLE.STY
%
% Elements configured here:
%
%       -> Control panel (high level control for LANGUAGE and COLORTHEME)
%       -> Language Support
%       -> Colors (switches between different color themes) [/CodexStyle/colorthemes/...]
%       -> General Packages
%       -> Document Layout (switches between different layouts) [/CodexStyle/layouts/...]
%       -> Math Setup (math packages)
%       -> Fonts (Body)
%       -> Fonts (Math)
%       -> Tables
%       -> Graphical Setup (tikz pgfplots)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%
%                 Control Panel                 %
%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%!%
%
\newcommand{\CodexLanguage}{english} % set language
\newcommand{\CodexColorTheme}{CodexStyle/colorthemes/colors_marine} % set colortheme (path to desired .sty)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                Language Support               %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[\CodexLanguage]{babel} % language support priority language last (set in control panel)

% French renamings ------------------------------
\addto\captionsfrench{\renewcommand\frenchtablename{{\FBfigtabshape Tableau}}} % rename table name (french)
\addto\captionsfrench{%
  \renewcommand{\refname}{Bibliographie}%
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                     Colors                    %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[x11names]{xcolor} % adds in typical color features
\usepackage{\CodexColorTheme} % choose a style (set in control panel)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%               General Packages                %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{setspace}  % line spacing
\usepackage{cite}      % in text citations
\usepackage{microtype} % small typography tweaks
\usepackage{graphicx}  % figure insertion
\usepackage{subfig}	   % allows for subfigures MIGRATE TO A MODERN PACKAGE MAYBE
\usepackage{geometry}  % document geometry
\usepackage{fancybox}  % boxes, frames etc
\usepackage{url}       % typographically sound URLs
\usepackage{float}     % Fixes hacky geometry problems
\usepackage[
format    = hang,
margin    = 5mm,
font      = small,
labelfont = bf,
labelsep  = space
]{caption}             % tweak caption layout and format
\usepackage{csquotes}  % For quotes
\usepackage{hyperref}[ % hyperref with some setup
    backref     = page,
    pagebackref = true,
    hyperindex  = true,
    bookmarks   = true,
    pdfa
]

% !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
% \usepackage[a-2b,mathxmp]{pdfx}[2018/12/22] % ???
% !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

% more hyperref options
\hypersetup{
    colorlinks=true,         % colorize links
    breaklinks=true,         % carriage return for long links
    urlcolor=URLColor,       % hyperlink url color
    linkcolor=LinkColor,     % internal link color
    citecolor=CiteColor,     % citation link color
    bookmarksopen=true,      % opens pdf bookmarks in the beginning
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                 Document Layout               %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Switches between longform and shortform automatically
\makeatletter
\@ifclassloaded{book}{ %%% BOOK %%%
    \usepackage{CodexStyle/layouts/longform_layout} % load longform
}{
\@ifclassloaded{article}{ %%% ARTICLE %%%
    \usepackage{CodexStyle/layouts/shortform_layout} % load shortform
}{
\@ifclassloaded{beamer}{ %%% BEAMER %%%
    \usepackage{CodexStyle/layouts/presentation_layout} % load presentation
}{
    \PackageError{mydoc}
        {Unsupported document class!}
        {`book` -> longform, `article` -> shortform, `beamer` -> presentation}
}}}
\makeatother


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                   Math Setup                  %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{amsmath}          % math environments
\usepackage{mathtools}        % tools for math formating
\usepackage[nice]{nicefrac}   % nicer fractions
\usepackage{cancel}           % allows to scratch expressions.
\usepackage{slashed}          % allows to slash individual characters.
\usepackage{xargs}            % better handling of optional arguments for commands
\usepackage{braket}           % convenient Dirac notation
\usepackage{empheq}           % colored boxes in math env
\usepackage[most]{tcolorbox}  % adds colorful box environments

%%% Import custom math macros
\usepackage{CodexStyle/macros} % custom latex macros (macros.sty)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                  Fonts (Body)                 %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{fontspec} % Finer font selection (requires Lua/XeLaTeX)
\usepackage{unicode-math} % Finer math font selection

% Main font switches based on documentclass
\makeatletter
\@ifclassloaded{book}{ %%% BOOK %%%
    \setmainfont{EB Garamond}[ % EB Garamond
        Ligatures   = TeX, % ligatures
        OpticalSize = On, % optical weight adjustment
        % Numbers     = OldStyle, % can be a little hard to read
        SmallCapsFeatures = {LetterSpace=5} % Adds spaces for small caps
    ]
}{
\@ifclassloaded{article}{ %%% ARTICLE %%%
    \setmainfont{Libertinus Serif}[ % Libertinus in short documents
        Ligatures = TeX,
        Kerning   = On,
    ]
}{
\@ifclassloaded{beamer}{ %%% BEAMER %%%
    \setmainfont{Libertinus Serif}[ % Libertinus in short documents
        Ligatures = TeX,
        Kerning   = On,
    ]
    \setsansfont{Libertinus Sans}
}{ %%% ELSE %%%
    \PackageError{mydoc} % throws an error
        {Unsupported document class!}
        {`book` -> longform, `article` -> shortform, `beamer` -> presentation}
}}}
\makeatother


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                  Fonts (Math)                 %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setmathfont{Libertinus Math}[ % nice neutral (near) universal math font
    Scale=MatchLowercase % set scale
]
\setmathfont{Latin Modern Math}[ % A few swaps and additions
    range = {\dagger, \ddagger, \mathcal}, % less dramatic daggers and distinct mathcal
    Scale=MatchLowercase % set scale
]


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                     Tables                    %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{array} % tabular functions
\usepackage{dcolumn} % allows for aligning of values wrt to the decimal
\newcolumntype{C}{>{$\displaystyle}c<{$}} % centered math column
\newcolumntype{L}{>{$\displaystyle}l<{$}} % left aligned math column
\newcolumntype{R}{>{$\displaystyle}r<{$}} % right aligned math column
\renewcommand{\arraystretch}{1.5} % vertical spacing of tables


%%% UNDER CONSTRUCTION %%%
%-----------------------------------------------
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                 Graphical Setup               %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{tikz}
\usetikzlibrary{
	calc,
	patterns,
	positioning,
    external,
    shapes,
    fit,
    backgrounds,
    arrows.meta,
	positioning,
    decorations,
    decorations.pathmorphing,
    decorations.markings,
    shapes.geometric,
    arrows
}
% \tikzexternalize[prefix=figures/pdf/]

\usepackage{pgfplots}
\pgfplotsset{compat=1.16}
\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}

\usepackage{CodexStyle/layouts/tikzstyles}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
